<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StreamX Live Ultimate</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#020617;
  color:white;
}
header{
  background:black;
  padding:15px;
  text-align:center;
}
.container{
  max-width:900px;
  margin:auto;
  padding:20px;
}
.card{
  background:#0f172a;
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
}
video{
  width:100%;
  background:black;
  border-radius:12px;
}
input,button{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:8px;
  border:none;
}
button{
  background:#22c55e;
  font-weight:bold;
}
.status{
  font-size:14px;
  margin-top:5px;
}
.controls{
  display:flex;
  gap:10px;
}
.controls button{
  flex:1;
}
.chat{
  height:150px;
  overflow:auto;
  background:#020617;
  padding:10px;
  border-radius:8px;
  font-size:14px;
}
</style>
</head>

<body>

<header>
  <h2>ðŸ“¡ StreamX Live Ultimate</h2>
</header>

<div class="container">

  <div class="card">
    <strong>Status:</strong>
    <div id="status" class="status">Connectingâ€¦</div>
  </div>

  <div class="card">
    <h3>ðŸŽ¥ Broadcaster</h3>
    <button onclick="startStream()">Start Live Stream</button>
    <input id="myId" readonly placeholder="Your Stream ID">

    <div class="controls">
      <button onclick="toggleMic()">Mute Mic</button>
      <button onclick="toggleCam()">Camera Off</button>
    </div>
  </div>

  <div class="card">
    <h3>ðŸ‘€ Viewer</h3>
    <input id="streamId" placeholder="Enter Stream ID">
    <button onclick="watchStream()">Watch Live</button>
  </div>

  <div class="card">
    <h3>ðŸ”´ Live Video</h3>
    <video id="video" autoplay playsinline controls></video>
  </div>

  <div class="card">
    <h3>ðŸ’¬ Live Chat (Demo)</h3>
    <div id="chat" class="chat"></div>
    <input id="msg" placeholder="Type message">
    <button onclick="sendMsg()">Send</button>
  </div>

</div>

<script>
let localStream;
let micOn = true;
let camOn = true;

const peer = new Peer(undefined,{
  host:'0.peerjs.com',
  port:443,
  secure:true
});

peer.on('open', id=>{
  document.getElementById('myId').value = id;
  document.getElementById('status').innerText = "Connected âœ” ID Ready";
});

peer.on('error', err=>{
  document.getElementById('status').innerText = "Error: " + err.type;
});

/* BROADCAST */
function startStream(){
  navigator.mediaDevices.getUserMedia({video:true,audio:true})
  .then(stream=>{
    localStream = stream;
    document.getElementById('video').srcObject = stream;
    document.getElementById('status').innerText = "LIVE ðŸ”´ Broadcasting";

    peer.on('call', call=>{
      call.answer(stream);
    });
  });
}

/* WATCH (FIXED) */
function watchStream(){
  const id = document.getElementById('streamId').value;
  if(!id){ alert("Enter Stream ID"); return; }

  navigator.mediaDevices.getUserMedia({video:false,audio:false})
  .then(stream=>{
    const call = peer.call(id, stream);

    call.on('stream', remoteStream=>{
      document.getElementById('video').srcObject = remoteStream;
      document.getElementById('status').innerText = "Watching Live";
    });
  });
}

/* CONTROLS */
function toggleMic(){
  if(!localStream) return;
  micOn = !micOn;
  localStream.getAudioTracks()[0].enabled = micOn;
}

function toggleCam(){
  if(!localStream) return;
  camOn = !camOn;
  localStream.getVideoTracks()[0].enabled = camOn;
}

/* CHAT DEMO */
function sendMsg(){
  const msg = document.getElementById('msg').value;
  if(!msg) return;
  const chat = document.getElementById('chat');
  chat.innerHTML += "<div>ðŸ’¬ " + msg + "</div>";
  document.getElementById('msg').value="";
}
</script>

</body>
</html>
